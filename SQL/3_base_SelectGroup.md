# Запросы, групповые операции

### Содержание <br>
[Выбор уникальных элементов столбца](#T1) <br>
[Выборка данных, групповые функции SUM и COUNT](#T2) <br>


<br>

### Структура и наполнение таблицы `book`
|book_id | title | author | price | amount|
| ---- | ---- | ---- | ---- | ---- |
|INT PRIMARY KEY AUTO_INCREMENT|	VARCHAR(50)|	VARCHAR(30)|	DECIMAL(8,2)|	INT|
1 | Мастер и Маргарита|	Булгаков М.А.|	670.99|	3|
2 |	Белая гвардия|	Булгаков М.А.|	540.50|	5|
3 |	Идиот |	Достоевский Ф.М. |	460.00 |	10|
4 |	Братья Карамазовы|	Достоевский Ф.М.|	799.01|	3|
5 |	Игрок|	Достоевский Ф.М.|	480.50|	10|
6 |	Стихотворения и поэмы|	Есенин С.А.|	650.00|	15|


<br><a name="T1"></a> 
# Выбор уникальных элементов столбца

`DISTINCT` - используется для того, чтобы отобрать уникальные элементы некоторого столбца. Размещается сразу после `SELECT`

#### **Пример** Выбрать различных авторов.

```SQL
SELECT DISTINCT author
FROM book;

--результат
+------------------+
| author           |
+------------------+
| Булгаков М.А.    |
| Достоевский Ф.М. |
| Есенин С.А.      |
+------------------+
```

Другой способ – использование оператора `GROUP BY`, который группирует данные при выборке, имеющие одинаковые значения в некотором столбце. Столбец, по которому осуществляется группировка, указывается после `GROUP BY` .

С помощью `GROUP BY` можно выбрать уникальные элементы столбца, по которому осуществляется группировка. Результат будет точно такой же как при использовании DISTINCT.

```SQL
SELECT  author
FROM book
GROUP BY author;
```
___


<br><a name="T2"></a> 
# Выборка данных, групповые функции SUM и COUNT

При группировке, можно выполнить различные действия, например, **просуммировать** `SUM` их или найти **количество** `COUNT` элементов в группе.

```SQL
SELECT author, sum(amount), count(amount)
FROM book
GROUP BY author;

--результат

+------------------+-------------+---------------+
| author           | sum(amount) | count(amount) |
+------------------+-------------+---------------+
| Булгаков М.А.    | 8           | 2             |
| Достоевский Ф.М. | 23          | 3             |
| Есенин С.А.      | 15          | 1             |
+------------------+-------------+---------------+
```

1.В таблице `book` определяются строки, в которых в столбце `author` одинаковые значения:

<img src="img/t1.jpg" alt="drawing" style="width:80%; text-align:center"/>

* **группа I** объединяет две записи, у которых в столбце `author` значение Булгаков М.А.;
* **группа II** объединяет три записи, `author` - Достоевский Ф.М.;
* **группа III** объединяет одну запись,`author` - Есенин С.А.

2.Вместо каждой группы в результирующий запрос включается  одна запись. Запись как минимум включает значение столбца, по которому осуществляется группировка - `author`:

<img src="img/t2.jpg" alt="drawing" style="width:80%; text-align:center"/>

3.Дальше можно выполнить вычисления над элементами КАЖДОЙ группы в отдельности, например, посчитать общее количество экземпляров книг каждого автора. Используется групповая функция `SUM(amount)`, в скобках столбец, по которому нужно выполнить суммирование:

<img src="img/t3.jpg" alt="drawing" style="width:80%; text-align:center"/>

4.Также можно посчитать, сколько записей относится к группе. Используется функция `COUNT()`, в скобках можно указать ЛЮБОЙ столбец из группы, если группа не содержит пустых значений:

<img src="img/t4.jpg" alt="drawing" style="width:80%; text-align:center"/>

> Рекомендуется всем  вычисляемым столбцам давать имя.

> `COUNT(*)` —  подсчитывает  все записи, относящиеся к группе, в том числе и со значением NULL;<br>
`COUNT(имя_столбца)` — возвращает количество записей конкретного столбца (только NOT NULL), относящихся к группе.